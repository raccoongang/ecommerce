{% load i18n %}
{% load core_extras %}
{% load currency_filters %}
{% load purchase_info_tags %}
{% load widget_tweaks %}

{% if not is_bulk_purchase %}
    {% include 'partials/alert_messages.html' %}
{% endif %}

<div id="content-inner">

    {% block basket_form_main %}
        <form action="." method="post">
            {% csrf_token %}
            {{ formset.management_form }}

            {% for form, line_data in formset_lines_data %}
                {% purchase_info_for_line request line_data.line as session %}
            
                <div class="basket-items">
                    <div class="row">
                        <div class="col-md-2 col-sm-12 product-image">
                            {{ form.id }}
                            <img class="thumbnail" src="../static/images/checkout-gray.svg"
                                 alt="Checkout"/>
                        </div>
                        <div class="col-md-10 col-sm-12">
                            {% if formset_lines_data.0.1.certificate_type != 'credit' %}
                                <p class="product-title">{{ formset_lines_data.0.1.course_name }}</p>
                                <p class="product-description">{% trans 'Credit Eligible Track' %}</p>
                            {% else %}
                                <p class="product-description">{% trans 'Get ' %}{{ formset_lines_data.0.1.credit_count }}{% trans ' credits from Arizona State University' %}</p>
                                <p class="product-title">{{ formset_lines_data.0.1.course_name }}</p>
                            {% endif %}

                        </div>
                        {% if line_data.enrollment_code %}
                            <div class="col-md-1 col-xs-12">
                                <label class="product-price-label text-muted">{% trans 'Item Price' %}</label>
                                <span>{{ line_data.line.price_incl_tax|currency:line_data.line.price_currency }}</span>
                            </div>
                            <div class="col-md-3 col-xs-12 form-inline">
                                <label class="product-price-label text-muted">{% trans 'Quantity' %}</label>
                                <div class="checkout-quantity form-group">
                                    <div class="input-group spinner  {% if form.errors %}error{% endif %}">
                                        {% render_field form.quantity class+="quantity form-control" min=min_seat_quantity %}
                                        <div class="input-group-btn-vertical">
                                            <button class="btn btn-primary" type="button">
                                              <i class="fa fa-caret-up"></i>
                                            </button>
                                            <button class="btn btn-primary" type="button">
                                              <i class="fa fa-caret-down"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary update-button" type="submit"
                                            data-loading-text="{% trans 'Updating...' %}">{% trans "Update" %}</button>
                                </div>
                            </div>
                        {% endif %}
                        <div class="col-md-{% if line_data.enrollment_code %}1{% else %}5{% endif %} col-xs-12 product-prices pull-right">
                            {% if line_data.enrollment_code %}
                                <label class="product-price-label text-muted">{% trans 'Price' %}</label>
                            {% endif %}

                            {% if line_data.line.has_discount %}
                                <div class="discount">
                                    <div class="benefit">
                                        {% blocktrans with benefit_value=line_data.benefit_value %}
                                            {{ benefit_value }} off
                                        {% endblocktrans %}
                                    </div>
                                    <div class="old-price">
                                        {{ line_data.line.line_price_incl_tax|currency:line_data.line.price_currency }}
                                    </div>
                                </div>
                            {% endif %}
                            <div class="price {% if line_data.line.has_discount %}discounted{% endif %}">
                                <span class="currency">$</span>
                               <span>{{ line_data.price }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </form>
    {% endblock %}
    {% if formset_lines_data.0.1.certificate_type != 'credit' %}
        <div class="about-asu-credit">

            <div class="about-asu-credit__image-holder">

            </div>
            <div class="about-asu-credit__text-holder">
                <h2>About the Credit Eligible Track</h2>

                <p>Before you can earn credit for a course, you must:</p>
                <ul>
                    <li>Verify your identity</li>
                    <li>Complete exam proctoring</li>
                    <li>Receive a passing grade in your course(s)</li>
                </ul>
                <p>Each course on your Credit Eligible Track carries course fees such as ID veriﬁcation and exam proctoring.</p>
                <p>You must verify your identity so we know who you are. This lets us ensure the academic credit you earn
                    appears on your official ASU transcript. You will be asked to take a photo of yourself and a valid photo ID
                    using a webcam. You will need to do this once per year.</p>
            </div>
        </div>
    {% else %}

        <div class="about-asu-credit">
            <div class="about-asu-credit__image-holder">
                <img src="../static/images/asu.png" alt="ASU">
            </div>
            <div class="about-asu-credit__text-holder">
                <h2>About Credit at ASU</h2>
                <p>Before you get your credit, check our <a href="https://ea.asu.edu/gpa-calculator">GPA calculator</a> to ensure the credit you’ve earned will help you gain admission to ASU; otherwise, you may consider repeating the course.</p>
                <h4>To get your credit:</h4>
                <ol>
                    <li>Click the Checkout button below.</li>
                    <li>Enter your payment information. </li>
                </ol>
                <p>After Arizona State University approves your credit you can request an official transcript from ASU.</p>
            </div>
        </div>
    {% endif %}
    <div class="row">
        <div class="col-sm-12">
            {# Switch Basket view in between single and bulk purchase items #}
            {% if partner_sku %}
                <div class="pull-left basket-switch-link">
                    <a href="/basket/single-item/?sku={{ partner_sku }}" class="btn btn-link">
                        {{ switch_link_text }}
                    </a>
                </div>
            {% endif %}

            <div class="pull-right payment-buttons" data-basket-id="{{ basket.id }}">
                {% if free_basket %}
                    <a href="{% url 'checkout:free-checkout' %}"
                       data-track-type="click"
                       data-track-event="edx.bi.ecommerce.basket.free_checkout"
                       data-track-category="checkout"
                       class="btn btn-success checkout-button">
                        {% trans "Place Order" %}
                    </a>
                {% else %}
                    {% for processor in payment_processors %}
                        <button data-track-type="click"
                                data-track-event="edx.bi.ecommerce.basket.payment_selected"
                                data-track-category="checkout"
                                data-processor-name="{{ processor.NAME|lower }}"
                                data-track-checkout-type="hosted"
                                class="btn payment-button"
                                id="{{ processor.NAME|lower }}">
                            {% if processor.NAME == 'cybersource' %}
                                {% trans "Checkout" %}
                            {% elif processor.NAME == 'paypal' %}
                                {# Translators: Do NOT translate the name PayPal. #}
                                {% trans "Checkout" %}
                            {% endif %}
                        </button>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>

</div>
